{% import "_includes/forms" as forms %}

<style>
    .mcp-settings-section {
        margin-bottom: 40px;
        padding-bottom: 30px;
        border-bottom: 1px solid #e3e5e8;
    }
    .mcp-settings-section:last-child {
        border-bottom: none;
    }
    .mcp-warning {
        padding: 15px;
        background: #fff4e6;
        border-left: 4px solid #ff9800;
        margin: 20px 0;
    }
    .mcp-info {
        padding: 15px;
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        margin: 20px 0;
    }
</style>

<div class="mcp-info">
    <strong>‚ÑπÔ∏è Informaci√≥n:</strong> Este plugin permite que Claude acceda a los contenidos de tu sitio Craft CMS mediante el protocolo MCP (Model Context Protocol).
    Configura qu√© recursos y herramientas estar√°n disponibles.
</div>

<div class="mcp-settings-section">
    <h2>üóÇÔ∏è Recursos Disponibles</h2>
    <p>Selecciona qu√© tipos de contenido estar√°n accesibles v√≠a MCP.</p>

    {{ forms.lightswitchField({
        label: 'Habilitar Entries',
        name: 'enableEntries',
        on: settings.enableEntries,
        instructions: 'Permite acceder a las entradas del sitio'
    }) }}

    {{ forms.lightswitchField({
        label: 'Habilitar Assets',
        name: 'enableAssets',
        on: settings.enableAssets,
        instructions: 'Permite acceder a los archivos y assets'
    }) }}

    {{ forms.lightswitchField({
        label: 'Habilitar Categor√≠as',
        name: 'enableCategories',
        on: settings.enableCategories,
        instructions: 'Permite acceder a las categor√≠as'
    }) }}

    {{ forms.lightswitchField({
        label: 'Habilitar Usuarios',
        name: 'enableUsers',
        on: settings.enableUsers,
        instructions: 'Permite acceder a la informaci√≥n de usuarios (usar con precauci√≥n)'
    }) }}
</div>

<div class="mcp-settings-section">
    <h2>üîí Secciones Permitidas</h2>
    <p>Limita el acceso a secciones espec√≠ficas. Deja vac√≠o para permitir todas.</p>

    {% set sectionOptions = [] %}
    {% for section in craft.app.sections.allSections %}
        {% set sectionOptions = sectionOptions|merge([{
            label: section.name ~ ' (' ~ section.handle ~ ')',
            value: section.handle
        }]) %}
    {% endfor %}

    {{ forms.checkboxSelectField({
        label: 'Secciones Accesibles',
        name: 'allowedSections',
        options: sectionOptions,
        values: settings.allowedSections,
        instructions: 'Si no seleccionas ninguna, todas las secciones estar√°n disponibles'
    }) }}
</div>

<div class="mcp-settings-section">
    <h2>üõ†Ô∏è Herramientas (Tools)</h2>
    <p>Habilita las herramientas que Claude podr√° usar para consultar contenidos.</p>

    {{ forms.lightswitchField({
        label: 'Tool: B√∫squeda de Entradas',
        name: 'enableSearchTool',
        on: settings.enableSearchTool,
        instructions: 'Permite buscar entradas por texto'
    }) }}

    {{ forms.lightswitchField({
        label: 'Tool: Detalles de Entrada',
        name: 'enableDetailsTool',
        on: settings.enableDetailsTool,
        instructions: 'Permite obtener informaci√≥n detallada de entradas espec√≠ficas'
    }) }}

    <div class="mcp-warning">
        <strong>‚ö†Ô∏è Precauci√≥n:</strong> Las consultas personalizadas permiten ejecutar queries complejas. Solo habilitar si conf√≠as completamente en los usuarios del MCP.
    </div>

    {{ forms.lightswitchField({
        label: 'Tool: Consultas Personalizadas',
        name: 'enableCustomQueries',
        on: settings.enableCustomQueries,
        instructions: 'Permite ejecutar consultas personalizadas definidas en la configuraci√≥n'
    }) }}
</div>

<div class="mcp-settings-section">
    <h2>üìä L√≠mites de Seguridad</h2>
    <p>Define l√≠mites para proteger el rendimiento del servidor.</p>

    {{ forms.textField({
        label: 'M√°ximo de Resultados',
        name: 'maxResults',
        value: settings.maxResults,
        type: 'number',
        instructions: 'N√∫mero m√°ximo de resultados que puede retornar cualquier consulta (1-1000)',
        min: 1,
        max: 1000
    }) }}

    {{ forms.textField({
        label: 'Complejidad M√°xima de Query',
        name: 'maxQueryComplexity',
        value: settings.maxQueryComplexity,
        type: 'number',
        instructions: 'Nivel m√°ximo de complejidad permitido para consultas (1-10)',
        min: 1,
        max: 10
    }) }}
</div>

<div class="mcp-settings-section">
    <h2>üè∑Ô∏è Campos Personalizados</h2>
    <p>Define qu√© campos personalizados estar√°n disponibles en las respuestas.</p>

    {{ forms.editableTableField({
        label: 'Campos a Exponer',
        name: 'exposedFields',
        instructions: 'Lista los handles de los campos personalizados que quieres incluir en las respuestas del MCP',
        cols: {
            field: {
                heading: 'Handle del Campo',
                type: 'singleline',
                width: '100%'
            }
        },
        rows: settings.exposedFields|map(field => {field: field}),
        addRowLabel: 'Agregar campo'
    }) }}

    <div class="mcp-info">
        <strong>üí° Tip:</strong> Puedes usar handles como: <code>myCustomField</code>, <code>richTextContent</code>, <code>featuredImage</code>, etc.
    </div>
</div>

<div class="mcp-settings-section">
    <h2>‚ö° Cache</h2>
    <p>Mejora el rendimiento almacenando resultados en cache.</p>

    {{ forms.lightswitchField({
        label: 'Habilitar Cache',
        name: 'enableCache',
        on: settings.enableCache,
        instructions: 'Activa el cache para respuestas de recursos'
    }) }}

    {{ forms.textField({
        label: 'Duraci√≥n del Cache (segundos)',
        name: 'cacheDuration',
        value: settings.cacheDuration,
        type: 'number',
        instructions: 'Tiempo que los recursos permanecer√°n en cache (recomendado: 3600 = 1 hora)',
        disabled: not settings.enableCache
    }) }}
</div>

<div class="mcp-settings-section">
    <h2>üîê Seguridad Avanzada (Opcional)</h2>
    <p>Configuraci√≥n adicional de seguridad para el acceso al MCP.</p>

    {{ forms.passwordField({
        label: 'Token de Acceso',
        name: 'accessToken',
        value: settings.accessToken,
        instructions: 'Token opcional para autenticar peticiones al MCP (dejar vac√≠o para desactivar)',
        placeholder: 'Genera un token seguro'
    }) }}

    {{ forms.textareaField({
        label: 'IPs Permitidas',
        name: 'allowedIpAddresses',
        value: settings.allowedIpAddresses|join("\n"),
        instructions: 'Lista de direcciones IP permitidas (una por l√≠nea). Dejar vac√≠o para permitir todas',
        placeholder: "192.168.1.1\n10.0.0.1",
        rows: 4
    }) }}
</div>

<div class="mcp-info">
    <h3>üìñ C√≥mo usar este plugin:</h3>
    <ol>
        <li>Configura los recursos y herramientas que deseas habilitar arriba</li>
        <li>En tu servidor, ejecuta el servidor MCP usando Node.js (ver documentaci√≥n)</li>
        <li>Configura Claude Desktop para conectarse v√≠a SSH a tu servidor</li>
        <li>¬°Listo! Claude podr√° consultar tus contenidos de Craft CMS</li>
    </ol>
    <p><strong>Comando de prueba:</strong> <code>php craft mcp/info</code></p>
</div>
